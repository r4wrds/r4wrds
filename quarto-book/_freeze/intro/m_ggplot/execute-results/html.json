{
  "hash": "75944e97d111c41993c00789ab719cbf",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Data visualization with ggplot2\ndescription: 'The grammar of graphics.\n\n  '\ncreative_commons: CC BY\n---\n\n\n\n\n\n\n:::obj\n\n**Learning objectives**\n \n - Learn how to create beautiful and informative plots from data  \n - Understand the grammar of graphics implemented in **`ggplot2`** and how to create plots in \"layers\"  \n - Learn core **`ggplot2`** geometries like `geom_point()`, `geom_line()`, `geom_col()`, `geom_boxplot()`, `geom_histogram()` \n - Understand how to customize and save plots\n\n:::\n  \n## Data visualization with **`ggplot2`**\n\nData visualization allows us to effectively explore data in an Exploratory Data Analysis (EDA), and allows us to communicate the results of an analysis or modeling exercise. A powerful package for data visualization in R is **`ggplot2`** (part of the **`tidyverse`** set of packages). **`ggplot2`** stands for \"**g**rammar of **g**raphics **plot**\" and generally provides a semantic syntax for data visualization that breaks down graphs in terms of *aesthetics*, *geoms*, *coordinates*, *scales*, and more, which allows users to create visualizations that range from simple to extraordinarily complex. The act of creating visualizations is not only useful, but also fun and motivating, so we cover it early, before more advanced data manipulation in subsequent modules. By the end of this module you will be able to create beautiful ggplots made entirely in R, and take your first steps towards reproducible and elegant data visualization.\n\n(ref:ah-ggplot) *Illustration by @allison_horst.*\n\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![(ref:ah-ggplot)](images/ggplot2.png){width=80%}\n:::\n:::\n\n\n\n\n\n\n## Examples\n\nBefore we begin, below are a few plots created entirely with **`ggplot2`** to illustrate the possibilities for data visualization enabled by this package. \n\nThese are only a few examples of the many possibilities that can be made. Because ggplots are so customizable, some people even use **`ggplot2`** to create artwork^[See https://art.djnavarro.net/ or https://www.data-imaginist.com/art]. Once you are familiar with how to customize a ggplot, you may be surprised to see them appear in major news outlets and scientific publications.  \n\n<aside> **`ggplot2`** art by [Antonio Sánchez Chinchón](https://fronkonstin.com/2018/03/11/mandalas-colored/) @aschinchon.\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](images/mandala.png){width=100%}\n:::\n:::\n\n\n\n\n</aside>\n\n\n(ref:cedric) *[Evolution of a ggplot](https://www.cedricscherer.com/2019/05/17/the-evolution-of-a-ggplot-ep.-1/), by Cedric Scherer shows how one can progressively refine and customize a gpplot.*\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![(ref:cedric)](images/ggplot_evolution.gif){width=80%}\n:::\n:::\n\n\n\n\n(ref:timo) *Created by [Timo Grossenbacher](https://timogrossenbacher.ch/2016/12/beautiful-thematic-maps-with-ggplot2-only/) @grssnbchr.*\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![(ref:timo)](images/switzerland.png){width=80%}\n:::\n:::\n\n\n\n\n(ref:cedric2) *Travelling to Outer Space by [Cédric Scherer](https://www.cedricscherer.com/top/dataviz/) @CedScherer.*\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![(ref:cedric2)](images/2020_29_Astronauts_blur_color.png){width=80%}\n:::\n:::\n\n\n\n\n\n## Creating your first ggplot\n\nTo begin, we load the **`ggplot2`** package. We can load it independently, but let's load it along with the **`tidyverse`** suite of R packages used in this course. We also need to load some data. Below we load a pre-processed dataframe that we'll create later in the module on joins and binds.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# includes ggplot2\nlibrary(tidyverse)\n\n# groundwater level from a single station in Sacramento County\ngwl <- read_csv(\"data/gwl/gwl.csv\")\n\n# inspect the data\nhead(gwl)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"SITE_CODE\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"MSMT_DATE\"],\"name\":[2],\"type\":[\"date\"],\"align\":[\"right\"]},{\"label\":[\"WSE\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"GSE_WSE\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"WLM_ORG_NAME\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"LATITUDE\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"LONGITUDE\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"COUNTY_NAME\"],\"name\":[8],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"WELL_DEPTH\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"WELL_USE\"],\"name\":[10],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"384121N1212102W001\",\"2\":\"2020-07-02\",\"3\":\"-25.20\",\"4\":\"159.20\",\"5\":\"Southeast Sacramento County Agricultural Water Authority\",\"6\":\"38.4121\",\"7\":\"-121.21\",\"8\":\"Sacramento\",\"9\":\"290\",\"10\":\"Unknown\"},{\"1\":\"384121N1212102W001\",\"2\":\"2020-06-26\",\"3\":\"-24.75\",\"4\":\"158.75\",\"5\":\"Southeast Sacramento County Agricultural Water Authority\",\"6\":\"38.4121\",\"7\":\"-121.21\",\"8\":\"Sacramento\",\"9\":\"290\",\"10\":\"Unknown\"},{\"1\":\"384121N1212102W001\",\"2\":\"2020-06-19\",\"3\":\"-25.39\",\"4\":\"159.39\",\"5\":\"Southeast Sacramento County Agricultural Water Authority\",\"6\":\"38.4121\",\"7\":\"-121.21\",\"8\":\"Sacramento\",\"9\":\"290\",\"10\":\"Unknown\"},{\"1\":\"384121N1212102W001\",\"2\":\"2020-06-12\",\"3\":\"-25.20\",\"4\":\"159.20\",\"5\":\"Southeast Sacramento County Agricultural Water Authority\",\"6\":\"38.4121\",\"7\":\"-121.21\",\"8\":\"Sacramento\",\"9\":\"290\",\"10\":\"Unknown\"},{\"1\":\"384121N1212102W001\",\"2\":\"2020-04-17\",\"3\":\"-21.06\",\"4\":\"155.06\",\"5\":\"Southeast Sacramento County Agricultural Water Authority\",\"6\":\"38.4121\",\"7\":\"-121.21\",\"8\":\"Sacramento\",\"9\":\"290\",\"10\":\"Unknown\"},{\"1\":\"384121N1212102W001\",\"2\":\"2020-03-20\",\"3\":\"-21.78\",\"4\":\"155.78\",\"5\":\"Southeast Sacramento County Agricultural Water Authority\",\"6\":\"38.4121\",\"7\":\"-121.21\",\"8\":\"Sacramento\",\"9\":\"290\",\"10\":\"Unknown\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\nThe 10 columns in the data contain are a `SITE_CODE` or unique identifier, a date-time `MSMT_DATE`, a water surface elevation `WSE_FT`, and a depth to groundwater `GSE_WSE`, the agency that collected the measurement `WLM_ORG_NAME`, a latitude and longitude, the county, the well depth, and the well use.  \n\nPerhaps we want to visualize the depth to groundwater at this site over time. To do this, we put `MSMT_DATE` on the x-axis and `GSE_WSE` on the y-axis.  \n\nTo create a ggplot we start with the function `ggplot()`.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot()\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/first-plot-1.png){width=100%}\n:::\n:::\n\n\n\n\nThe above plot appears blank because we haven't added any layers to it! A ggplot is nothing until we layer on one or more geometries or `geom`s.  \n\n\n## Adding `geom_` layers\n\n<aside>\nggplot can also create maps with `geom_sf()`, covered in the [mapmaking module](m_intro_mapmaking.qmd).  \n</aside>\n\nLet's add a `geom_line()` layer to the `ggplot()` we created above.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = gwl) +\n  geom_line(mapping = aes(x = MSMT_DATE, y = GSE_WSE))\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/geom-line-1.png){width=100%}\n:::\n:::\n\n\n\n\nLet's break down what we just did:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = <DATA>) + \n  <GEOM_FUNCTION>(mapping = aes(<MAPPINGS>))\n```\n:::\n\n\n\n\n<aside> See a full list of available geoms on the **`ggplot2`** [online documentation](https://ggplot2.tidyverse.org/reference/).  \n</aside>\n\nWe start creating a plot with the `ggplot()` function with our data (`data = gwl`). With `ggplot2`, each layer or piece of the ggplot is added by using a `+`.  We added a `geom_line()` which connects data points with a line, but there are many other geoms, including `geom_point()`, `geom_col()`, `geom_boxplot()`, `geom_histogram()`, and so on. Inside each `geom_`, there are many options, but the core arguments that allow us to tell the `geom_line()` function to put the date on the x-axis and depth to groundwater on the y-axis are arguments **`data`** and **`mapping`** . For the **`data`**, we are using the data specified in the `ggplot(data = gwl)` line, which means that data is available for any future layer or `geom` we use. To specify what pieces go on the x-axis and y-axis, we use the mapped aesthetics, `mapping = aes(x = MSMT_DATE, y = GSE_WSE)`.  \n\nIn practice, we don't need to explicitly write out all of the full argument names. **`ggplot2`** understands that mapping `aes(MSMT_DATE, GSE_WSE)` means that the measurement date and depth to groundwater belong on the x and y axis respectively. However, it is always a good idea to explicitly specify the **`data`** argument no matter what to avoid potential errors.\n\n<aside>\nIf using more than one dataframe, you can specify data in each geom function, rather than in `ggplot()`.  \n</aside>\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = gwl) +\n  geom_line(aes(MSMT_DATE, GSE_WSE))\n```\n:::\n\n\n\n\nWe can change the geom to a point:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = gwl) +\n  geom_point(aes(MSMT_DATE, GSE_WSE))\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/geom-point-1.png){width=100%}\n:::\n:::\n\n\n\n\nMany points overlap, making them hard to pick apart. Let's make them 50% opaque with the `alpha` argument.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = gwl) +\n  geom_point(aes(MSMT_DATE, GSE_WSE), alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/geom-point-alpha-1.png){width=100%}\n:::\n:::\n\n\n\n\nWe can change the geom to an area (notice that the y axis scale now has a minimum of 0): \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = gwl) +\n  geom_area(aes(MSMT_DATE, GSE_WSE))\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/geom-area-1.png){width=100%}\n:::\n:::\n\n\n\n\nWe can add more than one geom to the plot (just link them with the `+`), for instance a point and line. We can also set the color of a geom with the `color` argument.  \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = gwl) +\n  geom_point(aes(MSMT_DATE, GSE_WSE), alpha = 0.5) +\n  geom_line(aes(MSMT_DATE, GSE_WSE), color = \"red\", alpha = 0.7)\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/geom-multiple-1.png){width=100%}\n:::\n:::\n\n\n\n\nIt's often useful to summarize large datasets using summary values like the median, mean, interquartile range, and so on. What does the distribution of depths to groundwater look like at this particular well? \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() + \n  geom_histogram(data = gwl, aes(x = GSE_WSE))\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/geom-hist-1.png){width=100%}\n:::\n:::\n\n\n\n\nNotice that `geom_histogram()` takes only one argument for the x-axis and **computes** the bins for the y-axis. It appears that depths to groundwater range from around 130 to 160, with a median around 145. The default number of bins used is 30, but we can change this value.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = gwl) + \n  geom_histogram(aes(x = GSE_WSE), bins = 100)\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/geom-hist2-1.png){width=100%}\n:::\n:::\n\n\n\n\n:::challenge\n\n<font color=\"#009E73\">**Challenge 1: You Try!**</font> \n\n1. Modify the plot above to make the histogram blue (Hint: use `fill = \"blue\"`).  \n2. In the code above, change `geom_histogram()` to `geom_boxplot` and remove any `bins` and `fill` arguments.   \n\n:::\n\n<br>\n\n<details>\n  <summary class=\"challenge-ans-title\"><font color=\"#0072B2\">**Click for Answers!**</font></summary>\n  <div class=\"challenge-ans-body\">\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = gwl) + \n  geom_histogram(aes(GSE_WSE), bins = 100, fill = \"blue\")\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/challenge-1a-1.png){width=100%}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = gwl) + \n  geom_boxplot(aes(GSE_WSE))\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/challenge-1b-1.png){width=100%}\n:::\n:::\n\n\n\n\n\n  </div>\n</details>\n\n\n## Aesthetics\n\n**Aesthetics**, or `aes()` as we have seen, are how geoms map variables onto a plot. So far, we have only used the `x` and `y` aesthetics to map variables onto an x and y coordinate system. We can also add a third variable, like **color** to the aesthetics, and map values in the data to different colors. \n\n<aside>\nOther aesthetics you can map variables to include `shape`, `size`, and `fill`.\n</aside>\n\nSo far, we've been working with one monitoring site in Sacramento County, but to illustrate how mapping a variable to color can be useful, let's read in a slightly larger version of this groundwater level dataset that includes data from **10 monitoring sites** in Sacramento and Placer counties. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# groundwater level from 10 monitoring sites in Sacramento and Placer counties\ngwl_10 <- read_csv(\"data/gwl/gwl_10.csv\")\n\n# plot\nggplot(data = gwl_10) +\n  geom_point(aes(MSMT_DATE, GSE_WSE))\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/read-10-1.png){width=100%}\n:::\n:::\n\n\n\n\nPause for a moment to consider why does this data does not appear to have a clear trend.  \n\nLet's verify there are 10 unique sites in the data, then re-plot, and color the points by the `SITE_CODE` by assigning the variable `SITE_CODE` to the `color` argument *inside* the `aes()`.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# unique site codes in the dataframe\nunique(gwl_10$SITE_CODE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"382913N1213131W001\" \"384082N1213845W001\" \"385567N1214751W001\"\n [4] \"386016N1213761W001\" \"387511N1213389W001\" \"388974N1213665W001\"\n [7] \"383264N1213191W001\" \"382548N1212908W001\" \"388943N1214335W001\"\n[10] \"384121N1212102W001\"\n```\n\n\n:::\n\n```{.r .cell-code}\n# re-plot with color as an aesthetic\nggplot(data = gwl_10) +\n  geom_point(aes(x = MSMT_DATE, y = GSE_WSE, color = SITE_CODE), alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/plot-10-sites-1.png){width=100%}\n:::\n:::\n\n\n\n\nIt's now clear now which points belong to which group. Above, we *mapped* colored points by a categorical variable (`SITE_CODE`), but we can also color by a continuous variable, like the well depth.  \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# color the continuous well depth variable\nggplot(data = gwl_10) +\n  geom_point(aes(x = MSMT_DATE, y = GSE_WSE, color = WELL_DEPTH))\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/color-depth-1.png){width=100%}\n:::\n:::\n\n\n\n\nWhat if we were curious to know the distribution of depth to groundwater (y axis) at each of the 10 sites (x axis) in the `gwl_10` dataset?\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = gwl_10) +\n  geom_boxplot(aes(x = SITE_CODE, y = GSE_WSE))\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/dist1-1.png){width=100%}\n:::\n:::\n\n\n\n\nThose x axis labels are hard to read. What happens if we switch the x and y aesthetics?\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = gwl_10) +\n  geom_boxplot(aes(x = GSE_WSE, y = SITE_CODE))\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/dist2-1.png){width=100%}\n:::\n:::\n\n\n\n\nThat's easier to read. Let's also add some more intuitive labels.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = gwl_10) +\n  geom_boxplot(aes(x = GSE_WSE, y = SITE_CODE, color = WELL_USE)) +\n  labs(y = \"\", \n       x = \"Depth to groundwater (ft)\",\n       color = \"Well type\",\n       title = \"Depth to groundwater at 10 monitoring sites\",\n       subtitle = \"Sacramento and Placer county (1960-present)\",\n       caption = \"Source: Periodic groundwater level database, CA-DWR.\")\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/dist3-1.png){width=100%}\n:::\n:::\n\n\n\n\n## Faceting\n\nFaceting is a powerful way to split a plot by a categorical variable into many subplots, or **facets**. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = gwl_10) +\n  geom_line(aes(MSMT_DATE, GSE_WSE)) +\n  facet_wrap(~SITE_CODE)\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/facet1-1.png){width=100%}\n:::\n:::\n\n\n\n\nWe can improve the plot above by noticing that there are 10 facets, which would fit well into a grid of 5 rows and 2 columns, and also if we \"freed\" the scales so that they didn't all have the same x and y axis limits. We can achieve these changes by modifying the `nrow`, `ncol`, and `scales` arguments.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = gwl_10) +\n  geom_line(aes(MSMT_DATE, GSE_WSE)) +\n  facet_wrap(~SITE_CODE, ncol = 2, scales = \"free\")\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/facet2-1.png){width=100%}\n:::\n:::\n\n\n\n\nYou can also facet by 2 variables with `facet_grid()`. Here we facet by the county name and well use, and also separate individual sites within each facet by specifying `group = SITE_CODE`.  \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(gwl_10) +\n    geom_line(aes(MSMT_DATE, GSE_WSE, color = WELL_USE, group = SITE_CODE)) +\n    facet_grid(COUNTY_NAME~WELL_USE, scales = \"free\")\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/facet-grid-1.png){width=100%}\n:::\n:::\n\n\n\n\nWhat would happen if `group = SITE_CODE` were not included?  \n\n\n:::challenge\n\n<font color=\"#009E73\">**Challenge 2: You Try!**</font> \n\n1. Modify the plot above to color by the well use. (Hint: add `color = WELL_USE` inside the `aes()` function).  \n2. Using the `gwl_10` dataset, create a new ggplot. Use `geom_line()` to map `MSMT_DATE` to the x-axis and `GSE_WSE` to the y-axis. Then, color by the `SITE_CODE`, and facet by the `WELL_USE`.\n\n:::\n\n<br>\n\n<details>\n  <summary class=\"challenge-ans-title\"><font color=\"#0072B2\">**Click for Answers!**</font></summary>\n  <div class=\"challenge-ans-body\">\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = gwl_10) +\n  geom_line(aes(MSMT_DATE, GSE_WSE, color = WELL_USE)) +\n  facet_wrap(~SITE_CODE, ncol = 2, scales = \"free\")\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/challenge-2a-1.png){width=100%}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# color the continuous well depth variable\nggplot(data = gwl_10) +\n  geom_line(aes(MSMT_DATE, GSE_WSE, color = SITE_CODE)) + \n  facet_wrap(~WELL_USE, ncol = 1)\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/challenge-2b-1.png){width=100%}\n:::\n:::\n\n\n\n\n\n  </div>\n</details>\n\n\n## Saving plots\n\nThere are two main ways to get plots out of R and into a file, using a graphical device, or using a ggplot function `ggsave`. \n\n### Saving with a graphical device\n\nTo save using a graphical device, we essentially prepare a file of the type we want (i.e., a pdf or png or jpg). This is the \"graphical device\". Once we've opened our blank graphical file, we print the plot, and then close the device. This method (using a graphical device) works with any graphical output from R, not just ggplot.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# create a plot and save it to a variable\nmy_plot <- ggplot(data = gwl_10) +\n  geom_line(aes(MSMT_DATE, GSE_WSE, color = WELL_USE)) +\n  facet_wrap(~SITE_CODE, ncol = 2, scales = \"free\")\n\n# open a PDF graphical device\npdf(\"results/my_plot.pdf\")\n\n# print the plot\nmy_plot\n\n# close the graphical device\ndev.off()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nquartz_off_screen \n                2 \n```\n\n\n:::\n:::\n\n\n\n\nWe can print multiple plots into a PDF graphical device.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# create a plot and save it to a variable\nmy_plot_2 <- ggplot(gwl_10) +\n  geom_line(aes(MSMT_DATE, GSE_WSE, color = SITE_CODE)) + \n  facet_wrap(~WELL_USE, ncol = 1)\n\n# open a PDF graphical device\npdf(\"results/my_plots.pdf\")\n\n# print the plot\nmy_plot\nmy_plot_2\n\n# close the graphical device\ndev.off()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nquartz_off_screen \n                2 \n```\n\n\n:::\n\n```{.r .cell-code}\n# we will get a message about how many screens we still have open...this is ok!\n```\n:::\n\n\n\n\nWe can save a png file in the same way, and specify output height and width.  \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# open a PNG graphical device\npng(\"results/my_plot.png\", width = 10, height = 7, units = \"in\", res = 300)\n\n# print the plot\nmy_plot\n\n# close the graphical device\ndev.off()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nquartz_off_screen \n                2 \n```\n\n\n:::\n:::\n\n\n\n\n### Saving with `ggsave()`\n\nAnother way to save ggplots that involves less code is to use the `ggsave()` function. By default, `ggsave()` height and width arguments are understood to be in units of inches. This approach *only* works with plots that have been generated using the `ggplot2` package. To save different file types, we simply change the file extension to the format we want.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\"results/my_plot_ggsave.pdf\", my_plot, height = 10, width = 7)\nggsave(\"results/my_plot_ggsave.png\", my_plot)\n```\n:::\n\n\n\n\n\n## Colorblindness\n\n[Global estimates](https://www.colourblindawareness.org/colour-blindness/) suggest that 8% of men and 0.5% of women experience some form of colorblindness. When creating data visualizations, default palettes may not be colorblind-safe. Fortunately, **`ggplot2`** includes options for colorblind-safe scales. These can be used with both `color` and `fill` aesthetics by adding the `scale_<color or fill>_viridis_<c or d>` functions to our ggplots. \n\n\n\n\n::: {.cell preview='true'}\n\n```{.r .cell-code}\nggplot(data = gwl_10) +\n  geom_line(aes(MSMT_DATE, GSE_WSE, color = SITE_CODE)) +\n  scale_color_viridis_d() # a \"discrete\" viridis color palette.\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/vir-1.png){width=100%}\n:::\n:::\n\n\n\n\nAbove, the variable we want to map `WELL_USE` is mapped to a **color** and is a **discrete** variable, therefore, we use `scale_color_viridis_d()`. \n\nIf we were mapping a **continuous** variable to **color** we would use `scale_color_viridis_c()`.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = gwl) +\n  geom_line(aes(MSMT_DATE, GSE_WSE, color = MSMT_DATE)) +\n  scale_color_viridis_c(trans = \"date\")\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/vir2-1.png){width=100%}\n:::\n:::\n\n\n\n\nWe can toggle color palettes, and reverse them. See the [`viridis` vignette](https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html) for more info. \n\n<aside> Color is a vibrantly discussed and very customizable in R. A few resources for color palette selection include [colorbrewer2](https://colorbrewer2.org/), [sciviscolor.org](https://sciviscolor.org/), and [colorgorical](http://vrl.cs.brown.edu/color).\n</aside>\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = gwl) +\n  geom_line(aes(MSMT_DATE, GSE_WSE, color = MSMT_DATE)) +\n  scale_color_viridis_c(option = \"B\", direction = -1, trans = \"date\")\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/vir3-1.png){width=100%}\n:::\n:::\n\n\n\n\n## Bespoke plots\n\nWhat we've covered is just the tip of the iceberg. There are many, many more geoms, aesthetics, themes, scales, coordinates, and graphical libraries that extend the capabilities of ggplot. Once you have a handle on the grammar of graphics, bespoke plots are not far from your reach.  \n\nAdjusting the `theme()` of a plot is a powerful way to customize the look and feel of the visualization. For example, we may improve the plot below by simply applying one of many preset themes (\"`theme_<name>`\") and increasing the `base_size`.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np <- ggplot(data = gwl) +\n  geom_line(aes(MSMT_DATE, GSE_WSE, color = MSMT_DATE)) +\n  scale_color_viridis_c(option = \"B\", direction = -1, trans = \"date\") +\n  theme_minimal(base_size = 14) \np\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/theme-min-1.png){width=100%}\n:::\n:::\n\n\n\n\nLet's remove minor gridlines with a general call to the `theme()` function and specifying that the `panel.grid.minor` argument is a blank element.  \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np <- p +\n  theme(panel.grid.minor = element_blank())\np\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/unnamed-chunk-2-1.png){width=100%}\n:::\n:::\n\n\n\n\n\nWe can move the legend inside the plot area with another `theme()` argument, `legend.position`.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# place the legend position 90% along the x axis, and 25% along the y axis\np + theme(legend.position = c(0.9, 0.25))\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/legend-in-1.png){width=100%}\n:::\n:::\n\n\n\n\nWe can also move the legend to the top of the plot. If you type `legend.position` and read the documentation in the RStudio script editor, you'll notice the position argument options.\n\n<center>\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](images/legend_help.png){width=50%}\n:::\n:::\n\n\n\n</center>\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np + theme(legend.position = \"top\")\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/legend-top-1.png){width=100%}\n:::\n:::\n\n\n\n\nNow let's make the colorbar longer and thinner, move the legend title to the top, and center it. We'll also overwrite our former plot with this new one.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np <- p + \n  theme(legend.position = \"top\") + \n  guides(color = guide_colorbar(barwidth = unit(20, \"lines\"), \n                                barheight = unit(0.5, \"lines\"),\n                                title.hjust = 0.5, \n                                title.position = \"top\"))\np\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/legend-top-long-1.png){width=100%}\n:::\n:::\n\n\n\n\nWe can add a trend line by fitting a linear model to these data.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np <- p +\n  geom_smooth(data = gwl, aes(MSMT_DATE, GSE_WSE), \n              method = \"lm\", se = FALSE, linetype = \"dashed\")\np\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/trendline-1.png){width=100%}\n:::\n:::\n\n\n\n\nFinally, let's format some labels.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np <- p +\n  labs(x = \"\", y = \"Depth to groundwater (ft)\",\n       title = \"Site code: 384121N1212102W001\",\n       caption = \"Source: Periodic groundwater level database, CA-DWR.\")\np\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/unnamed-chunk-4-1.png){width=100%}\n:::\n:::\n\n\n\n\nJust about every aspect of plots can be customized with arguments in the `theme()` function. See `?theme` for a full list of options to customize. \n\nBuilt-in themes are also a quick way to change the look of your plots. Let's start over with a basic plot, view some built-in themes.\n\n<aside>\nFor even more themes, check out the [**`ggthemes`** package](https://github.com/jrnold/ggthemes).\n</aside>\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# basic plot\np <- ggplot(data = gwl) +\n  geom_line(aes(MSMT_DATE, GSE_WSE))\n\n# a built in theme \np + theme_bw()\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/theme-1.png){width=100%}\n:::\n\n```{.r .cell-code}\n# another built in theme\np + theme_dark(base_size = 18)\n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/theme-2.png){width=100%}\n:::\n:::\n\n\n\n\n\n\n:::challenge\n\n<font color=\"#009E73\">**Extra Practice**</font> \n\nThere are many built-in themes in **`ggplot2`**. Add a theme you haven't tried before to the `p` object from above. Type \"theme_\" and hit _Tab_ to view options.  \n\n:::\n\n<br>\n\n<details>\n  <summary class=\"challenge-ans-title\"><font color=\"#0072B2\">**Click for Answers!**</font></summary>\n  <div class=\"challenge-ans-body\">\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np + theme_classic() \n```\n\n::: {.cell-output-display}\n![](m_ggplot_files/figure-html/challenge-3a-1.png){width=100%}\n:::\n:::\n\n\n\n\n  </div>\n</details>\n\n\n## Extending ggplot2\n\nIf you want to learn more about `ggplot2`, check out these two free online resources:  \n\n- [ggplot2: elegant graphics for data analysis](https://ggplot2-book.org/index.qmd): This is the definitive ggplot2 guide written by the package author that emphasizes code and ggplot2 fundamental skills and concepts.  \n- [Fundamentals of Data Visualization](https://clauswilke.com/dataviz/): This book emphasizes principles of good data visualization that will inform the graphics you create.  \n\n\n<br>  \n\n\n",
    "supporting": [
      "m_ggplot_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}